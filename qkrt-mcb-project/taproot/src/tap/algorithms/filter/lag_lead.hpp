/*****************************************************************************/
/********** !!! WARNING: CODE GENERATED BY TAPROOT. DO NOT EDIT !!! **********/
/*****************************************************************************/

/*
 * Copyright (c) 2020-2025 Advanced Robotics at the University of Washington <robomstr@uw.edu>
 *
 * This file is part of Taproot.
 *
 * Taproot is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * Taproot is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Taproot.  If not, see <https://www.gnu.org/licenses/>.
 */
#ifndef TAPROOT_LAG_LEAD_HPP_
#define TAPROOT_LAG_LEAD_HPP_

#include "tap/algorithms/discrete_filter.hpp"

/**
 * @file lag_lead.hpp
 *
 * @brief Implementation of parts for a lag or lead controller, to be used with the discrete filter.
 *
 * @details
 * Lag-lead controllers are used to adjust the phase and gain of a system by allowing
 * for an addition of a zero and a pole in the transfer function.
 *
 * A lag controller is a single pole, single zero controller where the pole is at lower frequency
 * than the zero. It usually is used to reduce steady-state error by adding low frequency gain.
 * Think similar to a PI controller where the integral term is a lag compensator.
 *
 * A lead controller is a single pole, single zero controller where the pole is at higher frequency
 * than the zero. It usually is used to improve stability margins by adding low frequency phase lead
 * from the zero. Think similar to a PID controller where the derivative term is a lead compensator.
 *
 * A lead/lag controller has two poles and two zeros, with the poles sandwiching the zeros. This is
 * essentially a lag and a lead compensator in series.
 */
namespace tap::algorithms::filter
{
/**
 * @brief Computes the coefficients for a lag-lead controller
 *
 * @param k Gain of the controller
 * @param z Zero of the controller
 * @param p Pole of the controller
 * @param ts Sample time
 *
 * @return Coefficients for the lag-lead controller
 */
constexpr Coefficients<2, float> phaseLagLeadCoefficients(float k, float z, float p, float ts)
{
    const float a0 = 1.0f;
    const float a1 = (p * ts - 2.0f) / (p * ts + 2.0f);

    const float b0 = k * (z * ts + 2.0f) / (p * ts + 2.0f);
    const float b1 = k * (z * ts - 2.0f) / (p * ts + 2.0f);

    return Coefficients<2, float>{
        .naturalResponseCoefficients = {a0, a1},
        .forcedResponseCoefficients = {b0, b1}};
}
}  // namespace tap::algorithms::filter

#endif  // TAPROOT_LAG_LEAD_HPP_